---
title: "GNSUM_estimate_code_share"
author: "Nick_Fox"
date: "7/13/2018"
output: html_document
---

The following is code used to generate the Generalized Network Scale-Up Method (GNSUM) stimate and bootstrapped 95% confidence intervals of the proportion of American psychologists who have used at least one Questionable Research Practice in the past 12 months -  from Fox, Honeycutt, and Jussim 2018.  Please direct any questions to Nick Fox at nwf7@psych.rutgers.edu.

To see the output generated from the data, simply hit the knit button!

---------

From the 'boot' package, the estimate is output as "t1*".  For more info about the 'boot' package, see its documentation on CRAN: https://cran.r-project.org/web/packages/boot/boot.pdf

```{r echo = FALSE}
options(warn=-1)

#install packages - remove the hashtag if you need to install these packages, otherwise keep them hashed out.
#install.packages("tidyverse")
#install.packages("boot")

#load packages
suppressWarnings(suppressPackageStartupMessages(library(tidyverse)))
suppressWarnings(suppressPackageStartupMessages(library(boot)))

```

```{r echo = FALSE}

#reading in the data
#you'll want to have the data file 'NSUME_estimate_share' in your working directory.

GNSUM_data <- read.csv("GNSUM_estimate_share.csv", header = TRUE)

str(GNSUM_data)

```

```{r echo = FALSE}
#NSUME estimate function
GNSUME <- function(d, i){
  data <- d[i,]
  
  NSUM = sum(data$y_i, na.rm = TRUE) / sum(data$d_i, na.rm = TRUE)
  
  QRP_network <- data %>%
    filter(population == "QRP") %>% 
    summarise(mean = mean(network_size), na.rm = TRUE)
  
  general_network <- data %>%
    filter(population == "general") %>% 
    summarise(mean = mean(network_size), na.rm = TRUE)
  
  delta = (QRP_network$mean/general_network$mean)
  
  IK_TK <- data %>% 
    filter(quadrant == "IK_TK") %>% 
    summarise(sum = sum(count), na.rm = TRUE)
  
  IDK_TK <- data %>% 
    filter(quadrant == "IDK_TK") %>% 
    summarise(sum = sum(count), na.rm = TRUE)
  
  IDK_TDK <- data %>%
    filter(quadrant == "IDK_TDK") %>% 
    summarise(sum = sum(count), na.rm = TRUE)
  
  IK_TDK <- data %>%
    filter(quadrant == "IK_TDK") %>% 
    summarise(sum = sum(count), na.rm = TRUE)
  
  tau = (IK_TK$sum + IDK_TK$sum) / (IK_TK$sum + IDK_TK$sum + IDK_TDK$sum + IK_TDK$sum)

  
  return(NSUM * (1/delta) * (1/tau))
}

```


```{r echo = FALSE}
#sets a reproducible seed for the bootstrapping (626 is what is used for the publication)
set.seed(626)
#create bootstrap with 10,000 replicates (this might take awhile depending on your comptuer)
boot_GNSUME <- boot(GNSUM_data, GNSUME, R=10000)
#create output of bootstrapped estimate
boot_GNSUME
#create histogram of bootstrapped estimate
plot(boot_GNSUME)
#generate percentile bootstrapped 95% CIs
boot.ci(boot.out = boot_GNSUME, type = c("perc"))

```